<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>empMng.html(CRUD)</title>


<script onload="defer">
	// 페이지 로드하자 마자 함수 호출
	listReq();

	// 리스트 요청
	function listReq() {
		fetch('/ajax/empList')
		.then(res => res.json())
		.then(res => {
			console.log(res);
			listRes(res);
		})		
	}
	
	// 날짜 포멧 함수
	//function dateFormat(dt) {
	//	Date date = new Date();
	//}
	
	// 리스트 응답
	function listRes(res) {
		res.forEach((item, idx) => {
			//console.log(item)
			let bonusBtn = '<button>신청</button>';
			if(item.salary > 10000) {
				bonusBtn = '<button>미신청</button>'
			}
			let newTag = 
				`<tr>
					<td>${idx+1}</td>
					<td onclick="infoReq(${item.employeeId})">${item.employeeId}</td>
					<td>${item.firstName} ${item.lastName}</td>
					<td>${item.hireDate}</td>
					<td>${item.salary}</td>
					<td>${item.email}</td>
					<td>
						${bonusBtn}
					</td>
					<td>
						<button type="button" onclick="move(${item.employeeId})">조회</button>
					</td>
				</tr>`;
				
			empList.innerHTML += newTag;
		})
	}
	
	// 등록 요청
	function saveReq() {
		// 1.queryString : ?key=value
		const lastName = frm.lastName.value;
		const email = frm.email.value;
		const hireDate = frm.hireDate.value;
		const jobId = frm.jobId.value;
		// let param = `lastName=${lastName}&email=${email}&hireDate=${hireDate}&jobId=${jobId}`;
		// let param = new FormData(document.frm); // 2. FormData
		
		let param = {lastName, email, jobId, hireDate }
		fetch("/ajax/emp",{
			method : "post",
			headers: {
			      "Content-Type": "application/json"
			},
			body : JSON.stringify(param)
		})
	}
	// 등록 응답
	function saveRes(res) {
		listReq();
	}
	
	
	// 상세조회 요청
	function infoReq(employeeId) {
		fetch(`/ajax/emp/${employeeId}`)
		.then(res => res.json())
		.then(res => infoRes(res))
		
	}
		
	// 상세조회 응답
	function infoRes(res) {
		console.log(res)
		// input tag에 표시
		frm.email.value = res.email;
		frm.lastName.value = res.lastName;
		frm.jobId.value = res.jobId;
		frm.hireDate.value = res.hireDate;
	}
	
</script>


</head>
<body>
<div layout:fragment="content">
	<h3>사원목록조회</h3>
		<div>
			<table border="1">
				<thead>
					<tr>
						<th>No.</th>
						<th>employee_id</th>
						<th>name</th>
						<th>hire_date</th>
						<th>salary</th>
						<th>email</th>
						<th>보너스</th>
						<th>수정/삭제</th>
					</tr>
				</thead>
				<tbody id="empList">
									
				</tbody>
			</table>
		</div>
	
	<h3>사원(등록, 조회)</h3>
	<form method="post" name="frm">
		lastName<input name="lastName">
		hireDate<input name="hireDate">
		jobId<select name="jobId">
			<option value="IT_PROG">Programmer</option>
			<option value="ST_MAN">Stock Manager</option>
		</select>
		이메일<input name="email">
		<button type="button" onclick="saveReq()">등록</button>
	</form>
	
	
	<br>
	<div class="footerSector" th:insert="~{footer}">여기에 삽입</div>
</div>
</body>
</html>